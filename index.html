<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal spending management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.15.1/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body class="bg-gray-50">
    Æ°
    <main class="container bg-gray-50 mx-auto max-w-3xl p-4">
        <div class="bg-white rounded-2xl shadow-lg p-5" x-data="app()" x-init="init()">
            <h1 class="text-xl text-center text-gray-700 uppercase font-semibold mb-4">Personal spending management</h1>
            <section class="border border-gray-200 rounded-xl p-3 mb-4 flex justify-between gap-3">
                <div><span class="font-semibold uppercase text-gray-500 text-sm">Total amount </span><br /><span
                        class="text-emerald-700 font-bold" x-text="fmt(balance())"></span></div>
                <div><span class="font-semibold uppercase text-gray-500 text-sm">Total revenue </span><br /><span
                        class="text-blue-600 font-bold" x-text="fmt(sum('income'))"></span></div>
                <div><span class="font-semibold uppercase text-gray-500 text-sm">Total expenditure </span><br /><span
                        class="text-rose-600 font-bold " x-text="fmt(sum('expense'))"></span>
                </div>
            </section>
            <!-- Add -->
            <h2 class="text-gray-600 text-left font-semibold uppercase">Add transactions</h2>
            <section class="border boder-gray-200 rounded-xl p-3 mb-4 flex flex-wrap gap-4">

                <div class="flex-1 min-w-[120px]">
                    <label class="block mb-1 text-sm font-medium text-gray-700">Type</label>
                    <select x-model="form.type"
                        class="w-full px-3 py-2 border text-gray-500 border-gray-300 rounded-lg">
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                    </select>
                </div>

                <div class="flex-1 min-w-[120px]">
                    <label class="block mb-1 text-sm font-medium text-gray-700">Category</label>
                    <select x-model="form.category"
                        class="w-full px-3 py-2 border text-gray-500 border-gray-300 rounded-lg">
                        <template x-for="cat in formcategories" :key="cat.value">
                            <option :value="cat.value" x-text="cat.label"></option>
                        </template>
                    </select>
                </div>

                <div class="flex-1 min-w-[120px]">
                    <label class="block mb-1 text-sm font-medium text-gray-700">Amount</label>
                    <input type="number" min="0" placeholder="0" x-model.number="form.amount"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                </div>

                <div class="flex-1 min-w-[150px]">
                    <label class="block mb-1 text-sm font-medium text-gray-700">Note</label>
                    <input type="text" x-model="form.note" placeholder="(Optional)"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg" />
                </div>

                <div class="self-end">
                    <button @click="add()"
                        class="px-4 py-2 bg-blue-500 text-white border border-gray-300 rounded-lg hover:bg-blue-600">Add</button>
                </div>

            </section>
            <!-- Filter -->
            <h5 class="text-gray-600 font-semibold uppercase text-left">Filter </h5>
            <section class="border border-gray-200 rounded-xl p-3 mb-4 flex gap-2">

                <label for="" class="flex items-center gap-2">
                    <input type="radio" value="all" x-model="filter"> All
                </label>
                <label for="" class="flex items-center gap-2">
                    <input type="radio" value="income" x-model="filter"> Income
                </label>
                <label for="" class="flex items-center gap-2">
                    <input type="radio" value="expense" x-model="filter"> Expense
                </label>
                <input type="text" x-model.debounce="searchQuery" placeholder="Search by note "
                    class="px-3 py-2 border border-gray-300 rounded-lg flex-1 min-w-[]">
                <select x-model="sortBy" class="px-3 py-2 border text-gray-500 border-gray-300 rounded-lg">
                    <option value="date_desc">Newest first</option>
                    <option value="date_asc">Oldest first</option>
                    <option value="amount_desc">Amount (high-low)</option>
                    <option value="amount_asc">Amount (low-high)</option>
                </select>
            </section>
            <h5 class="text-gray-600 font-semibold uppercase text-left">List </h5>
            <!-- List -->
            <section class="border border-gray-200 rounded-xl p-3 mb-4">
                <template x-if="filteredItem.length === 0">
                    <div class="text-sm text-gray-500">no transactions yet.</div>
                </template>
                <ul class="list-none p-0 m-0 space-y-0 max-h-40 overflow-y-auto">
                    <template x-for="t in filteredItem" :key="t.id">
                        <li class="flex items-center gap-3 py-3 border-b border-gray-200 last:border-b-0">
                            <span class="text-xs px-2 py-1 rounded-full"
                                :class="t.type==='income' ? 'bg-emerald-50 text-emerald-700' : 'bg-rose-50 text-rose-700'"
                                x-text="t.type==='income' ? 'INC' : 'EXP'"></span>

                            <div class="min-w-0 flex-1">
                                <!-- <div class="truncate" x-text="t.note || (t.type==='income' ? 'income' : 'expense')">
                                </div> -->
                                <div class="truncate">
                                    <span class="font-medium"
                                        x-text="category.find(c=>c.value===t.category)?.label||t.category"></span>
                                    <template x-if="t.note">
                                        <span class="text-gray-500 text-sm" x-text="': '+t.note"></span>
                                    </template>
                                </div>
                            </div>

                            <div class="text-right min-w-[140px]"
                                :class="t.type==='income' ? 'text-emerald-700' : 'text-rose-700'">
                                <b x-text="(t.type==='income' ? '+' : '-') + fmt(t.amount)"></b>
                            </div>
                            <button @click="openEditModal(t)" title="Edit"
                                class="text-xs text-black rounded-2xl hover:text-blue-600 hover:bg-blue-100 px-2 py-1 bg-blue-300">Edit</button>
                            <button @click="del(t.id)" title="Delete"
                                class="text-xs text-black rounded-2xl hover:text-rose-600 hover:bg-red-100 px-2 py-1 bg-red-300 ">
                                Delete
                            </button>
                        </li>
                    </template>
                </ul>
            </section>
            <!-- Edit Modal -->
            <div x-show="isModalOpen" x-transition @click.away="cancelEdit" style="display: none;"
                class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-2xl shadow-lg p-6 max-w-md w-full">
                    <div class="flex justify-between">
                        <h2 class="text-xl font-semibold mb-4 hover:text-blue-300">
                            Edit
                        </h2>
                        <button @click="cancelEdit" class="hover:text-rose-600">x</button>
                    </div>
                    <template x-if="editingItem">
                        <div class="space-y-4">
                            <div>
                                <label for="" class="block mb-1 forn-medium">Type</label>
                                <select x-model="editingItem.type" name="" id=""
                                    @change="editingItem.category=editCategories[0].value"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                    <option value="expense">Expense</option>
                                    <option value="income">Income</option>
                                </select>
                            </div>
                            <div>
                                <label for="" class="block mb-1 fotn-medium">Category</label>
                                <select x-model="editingItem.category"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                    <template x-for="cat in editCategories" :key="cat.value">
                                        <option :value="cat.value" x-text="cat.label"></option>

                                    </template>
                                </select>
                            </div>
                            <div>
                                <lable class="block mb-1 font-medium">Amount</lable>
                                <input class="w-full px-3 py-2 border border-gray-300 rounded-lg" type="number" min="0"
                                    x-model.number="editingItem.amount" />
                            </div>
                            <div>
                                <label for="" class="block mb-1 font-medium">Note</label>
                                <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg"
                                    x-model="editingItem.note" />
                            </div>
                            <div class="flex justify-end gap-3 pt-4">
                                <button @click="cancelEdit"
                                    class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button>
                                <button @click="saveEdit"
                                    class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">Save</button>
                            </div>
                        </div>
                    </template>

                </div>
            </div>
        </div>
    </main>
    <script>
        function app() {
            return {
                items: [],
                filter: 'all',
                form: { type: 'expense', amount: 0, note: '', category: 'Food' },
                searchQuery: '',
                sortBy: 'date_desc',
                isModalOpen: false,
                editingItem: null,
                category: [
                    { value: 'Food', label: 'Food', type: 'expense' },
                    { value: 'Transport', label: 'Transport', type: 'expense' },
                    { value: 'Health', label: 'Health', type: 'expense' },
                    { value: 'Utilities', label: 'Utilities', type: 'expense' },
                    { value: 'Entertainment', label: 'Entertainment', type: 'expense' },
                    { value: 'Shopping', label: 'Shopping', type: 'expense' },
                    { value: 'Salary', label: 'Salary', type: 'income' },
                    { value: 'Business', label: 'Business', type: 'income' },
                    { value: 'OtherExpense', label: 'Other', type: 'expense' },
                    { value: 'OtherIncome', label: 'Other', type: 'income' },
                ],
                init() {
                    try {
                        const raw = localStorage.getItem('spending-app-data');
                        this.items = JSON.parse(raw) || [];
                    }
                    catch { }
                    this.$watch('items', () => {
                        localStorage.setItem('spending-app-data', JSON.stringify(this.items));
                    })
                    this.$watch('form.type', (value) => {
                        const newCategories = this.category.filter(cat => cat.type === value);
                        if (newCategories.length > 0) {
                            this.form.category = newCategories[0].value;
                        }
                    })
                },
                add() {
                    const a = Number(this.form.amount);
                    if (!a || a < 0) return alert('Please enter a valid amount!');
                    this.items.unshift({
                        id: Date.now(),
                        type: this.form.type,
                        category: this.form.category,
                        amount: Math.round(a),
                        note: (this.form.note || '').trim(),

                    })
                    this.form = { type: 'expense', amount: null, note: '', category: 'Food' };
                },
                del(id) {
                    this.items = this.items.filter(i => i.id !== id);
                },
                // filtered() {
                //     if (this.filter == 'all') return this.items;
                //     return this.items.filter(i => i.type === this.filter);
                // },
                get filteredItem() {
                    let filtered = this.items;
                    if (this.filter !== 'all') {
                        filtered = filtered.filter(i => i.type === this.filter);
                    }
                    if (this.searchQuery.trim() !== '') {
                        const query = this.searchQuery.toLowerCase();
                        filtered = filtered.filter(i => {
                            const inNote = i.note.toLowerCase().includes(query);
                            const catLabel = this.category.find(c => c.value === i.category)?.label || ''
                            const inCategory = catLabel.toLowerCase().includes(query);
                            return inNote || inCategory;
                        })
                    }
                    if (this.sortBy === 'date_desc') {

                        filtered.sort((a, b) => b.id - a.id);
                    } else if (this.sortBy === 'date_asc') {
                        filtered.sort((a, b) => a.id - b.id);
                    } else if (this.sortBy === 'amount_desc') {
                        filtered.sort((a, b) => b.amount - a.amount);
                    } else if (this.sortBy === 'amount_asc') {
                        filtered.sort((a, b) => a.amount - b.amount);
                    }
                    return filtered;
                },
                sum(type) { return this.items.filter(i => i.type === type).reduce((s, i) => s + (i.amount || 0), 0); },
                balance() { return this.sum('income') - this.sum('expense') },
                fmt(n) { return n.toLocaleString('en-ES', { style: 'currency', currency: 'USD' }); },
                openEditModal(item) {
                    // spread operator (copy)
                    this.editingItem = { ...item };
                    this.isModalOpen = true;
                },
                saveEdit() {
                    if (!this.editingItem) return;
                    this.items = this.items.map(i => {
                        if (i.id === this.editingItem.id) {
                            return this.editingItem;
                        }
                        return i;
                    });
                    this.cancelEdit();
                },
                cancelEdit() {
                    this.isModalOpen = false;
                    this.editingItem = null;

                },
                get formcategories() {
                    return this.category.filter(cat => cat.type === this.form.type);
                },
                get editCategories() {
                    if (!this.editingItem) return [];
                    return this.category.filter(cat => cat.type === this.editingItem.type)
                }
            }
        }
    </script>

</body>

</html>